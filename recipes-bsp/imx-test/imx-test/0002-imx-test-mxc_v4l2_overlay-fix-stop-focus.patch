From 97b960f4554fc3639b5bec568a876e23d7ff4266 Mon Sep 17 00:00:00 2001
From: Harshesh Valera <harshesh.v@variscite.com>
Date: Tue, 22 Jan 2019 14:09:48 -0800
Subject: [PATCH 2/2] imx-test: mxc_v4l2_overlay: fix stop focus

Fixes to release AF focus ctrl to stop AF

Signed-off-by: Harshesh Valera <harshesh.v@variscite.com>
---
 test/mxc_v4l2_test/mxc_v4l2_overlay.c | 12 ++++++++----
 1 file changed, 8 insertions(+), 4 deletions(-)

diff --git a/test/mxc_v4l2_test/mxc_v4l2_overlay.c b/test/mxc_v4l2_test/mxc_v4l2_overlay.c
index f89824c..9025323 100644
--- a/test/mxc_v4l2_test/mxc_v4l2_overlay.c
+++ b/test/mxc_v4l2_test/mxc_v4l2_overlay.c
@@ -606,8 +606,6 @@ main(int argc, char **argv)
 	struct sigaction act;
 	struct v4l2_dbg_chip_ident chip;
 	struct v4l2_control c;
-		c.id = V4L2_CID_FOCUS_AUTO;
-		c.value = 1;
 
 	print_name(argv);
 
@@ -728,10 +726,16 @@ main(int argc, char **argv)
 			return TFAIL;
 		}
 	}
-
+	if (af_enabled) {
+		c.id = V4L2_CID_FOCUS_AUTO;
+		c.value = 1;
+	} else {
+		c.id = V4L2_CID_AUTO_FOCUS_STOP;
+		c.value = 0;
+	}
         if (ioctl(fd_v4l, VIDIOC_S_CTRL, &c) < 0)
         {
-                printf("Warning! VIDIOC_S_CTRL failed Focus Control not available!!\n");
+                printf("Warning! VIDIOC_S_CTRL failed AF ctrls unavailable!\n");
         }
 
         if (!g_overlay) {
-- 
2.7.4

